## Extracting Data from PDFs with Gemini: A Complete Example

In this blog post, we'll walk through building a pipeline to extract precise data from PDFs using Google's Gemini API. A sample PDF and expected output are included to help you test and understand the workflow.

### Why Gemini?

Gemini offers a powerful combination of a large language model (LLM) with a generous free tier. This makes it a cost-effective solution for experimenting with and processing a significant amount of data.

### Our Goal

To build a Python-based pipeline that can:
1. **Preprocess PDFs**: Convert PDFs into a format suitable for Gemini.
2. **Use the Gemini API**: Send the processed data to Gemini and receive results.
3. **Extract Key Information**: Identify and extract company names and activities.

---

### Sample PDF (`example.pdf`)

To test the pipeline, use the following text in a sample PDF named `example.pdf`:

```
Acme Corp is a leading technology company specializing in artificial intelligence and machine learning solutions. Based in San Francisco, Acme Corp develops cutting-edge software for data analysis, natural language processing, and computer vision.

Beta Industries is a global manufacturing company headquartered in New York City. They are involved in the production of sustainable materials and renewable energy technologies. Beta Industries is committed to environmental responsibility and innovation.
```

---

### Step 1: Setting up Your Environment

#### Get your Gemini API Key

1. Go to [Google AI Studio](https://aistudio.google.com/).
2. If you don't have an account, create one.
3. Navigate to the "Models" section.
4. Find "Gemini" and click "View model card."
5. Click the "Generate API key" button.
6. Copy the API key and store it securely.

#### Install Necessary Packages

```bash
pip install -q -U google-generativeai PyPDF2
```

This installs the Gemini API SDK (`google-generativeai`) and a library for handling PDFs (`PyPDF2`).

#### Set up your API key

Configure your API key as an environment variable to avoid hardcoding sensitive information.

```bash
export API_KEY=<YOUR_API_KEY> 
```

#### Import necessary libraries and configure

```python
import google.generativeai as genai
import os
import PyPDF2  # For PDF handling

genai.configure(api_key=os.environ["API_KEY"])
```

---

### Step 2: Preprocessing PDFs

This step is crucial for cleaning and preparing your PDFs for Gemini.

```python
def preprocess_pdf(pdf_path):
    """
    Extracts text from a PDF and performs basic cleaning.

    Args:
        pdf_path: Path to the PDF file.

    Returns:
        cleaned_text: A string containing the extracted and cleaned text.
    """
    text = ""
    with open(pdf_path, 'rb') as pdf_file:
        pdf_reader = PyPDF2.PdfReader(pdf_file)
        for page in pdf_reader.pages:
            text += page.extract_text()
    cleaned_text = " ".join(text.split())  # Remove extra whitespace
    return cleaned_text
```

---

### Step 3: Interacting with the Gemini API

Now, let's define a function to interact with Gemini.

```python
def get_gemini_response(text, prompt_template):
    """
    Sends a request to the Gemini API and returns the response.

    Args:
        text: The text extracted from the PDF.
        prompt_template: A template for the prompt, including placeholders for the text.

    Returns:
        response_text: The text generated by Gemini.
    """
    model = genai.GenerativeModel("gemini-1.5-flash") 

    prompt = prompt_template.format(text=text)
    response = model.generate_content(prompt)
    return response.text
```

---

### Step 4: Extracting Information

This step involves crafting the right prompt and using the response to extract specific information.

```python
import json

def extract_information(gemini_response):
    """
    Extracts company names and activities from the Gemini response.

    Args:
        gemini_response: The text generated by Gemini.

    Returns:
        extracted_data: A dictionary containing the extracted information.
    """
    prompt_template = """
    Identify the companies mentioned in this text and their main activities:
    {text}

    Provide your answer in the following JSON format:
    {{"companies": [
        {{"name": "company name 1", "activity": "main activity of company 1"}},
        {{"name": "company name 2", "activity": "main activity of company 2"}},
        ...
    ]}}
    """

    response = get_gemini_response(gemini_response, prompt_template)
    try:
        data = json.loads(response)
        return data
    except json.JSONDecodeError:
        print("Error: Invalid JSON response from Gemini.")
        return None
```

---

### Step 5: Putting it All Together

Finally, let's combine these functions into a complete pipeline.

```python
def process_pdf(pdf_path):
    """
    Processes a PDF to extract company names and activities.

    Args:
        pdf_path: Path to the PDF file.

    Returns:
        extracted_data: A dictionary containing the extracted information.
    """
    text = preprocess_pdf(pdf_path)
    gemini_response = get_gemini_response(text, prompt_template)
    extracted_data = extract_information(gemini_response)
    return extracted_data

# Example usage
pdf_path = "example.pdf"  # Replace with your sample PDF path
extracted_data = process_pdf(pdf_path)
print(extracted_data)
```

---

### Expected Output

After running the code, you should see an output similar to the following JSON format:

```json
{
  "companies": [
    {
      "name": "Acme Corp",
      "activity": "technology company specializing in artificial intelligence and machine learning solutions"
    },
    {
      "name": "Beta Industries",
      "activity": "global manufacturing company involved in the production of sustainable materials and renewable energy technologies"
    }
  ]
}
```

---

### Running the Example

1. **Save the Code**: Save the code above as a Python file (e.g., `pdf_extractor_gemini.py`).
2. **Create `example.pdf`**: Create a PDF file named `example.pdf` with the sample text provided.
3. **Set Up Gemini API**: Ensure your Google AI Studio settings are configured and the API key is set.
4. **Run the Script**: Execute the script from your terminal: `python pdf_extractor_gemini.py`

---

### Important Notes

- **Fine-tuning**: Fine-tune Gemini 1.5 Flash on a dataset of similar PDFs to significantly improve accuracy.
- **Prompt Engineering**: Experiment with different prompts and output structures to optimize the extraction process.
- **Error Handling**: Implement robust error handling to deal with potential issues like invalid PDFs or unexpected responses from Gemini.
- **Rate Limits**: Be mindful of the Gemini API's free tier rate limits.

---

### Optimizing with Parallel Processing for Multiple PDFs

To further streamline your pipeline, consider processing multiple PDFs concurrently. The Gemini APIâ€™s rate limits (1 million tokens per minute and 1,500 requests per day) allow for substantial parallel processing within the free tier. By running concurrent requests, you can speed up the overall extraction workflow, making it more scalable for large datasets.

---

### Conclusion

This guide provides a foundation for building a PDF data extraction pipeline using Gemini, tailored for large-scale document processing. By following these steps, you can create a robust, cost-effective solution for extracting precise information from complex documents like SEC filings. With additional fine-tuning and prompt optimization, this pipeline can be adapted for various document types and extraction tasks, making it a flexible tool for your data processing needs.
